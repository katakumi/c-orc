<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <style type="text/css">
        @font-face {
            font-family: "Material-Design-Icons";
            src: url("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/font/material-design-icons/Material-Design-Icons.eot?-g7cqhn");
            src: url("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/font/material-design-icons/Material-Design-Icons.eot?#iefix-g7cqhn") format("embedded-opentype"), url("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/font/material-design-icons/Material-Design-Icons.woff?-g7cqhn") format("woff"), url("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/font/material-design-icons/Material-Design-Icons.ttf?-g7cqhn") format("truetype"), url("https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/font/material-design-icons/Material-Design-Icons.svg?-g7cqhn#Material-Design-Icons") format("svg");
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Dynatable/0.3.1/jquery.dynatable.min.css">
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Dynatable/0.3.1/jquery.dynatable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
    <script src="https://openlayers.org/en/v4.6.4/build/ol.js"></script>
</head>
<body>
<nav>
    <div class="nav-wrapper">
        <a href="#" class="brand-logo">Viewer</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="sass.html">Test</a></li>
            <li><a href="badges.html">Add</a></li>
            <li><a href="collapsible.html">Exit</a></li>
        </ul>
    </div>
</nav>


<div class="container">
    <h3 class="header light">Task Monitor</h3>
    <div class="row">
        <table id="my-final-table" class="striped highlight">
            <thead>
            <th>Name</th>
            <th>WCA</th>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<!-- Map -->
<div class="container">
    <h3 class="header light">WCA Monitor</h3>
    <div class="row">
        <div id="map" class="map"></div>
    </div>
</div>


<div class="container">
    <h3 class="header">Task</h3>
    <div class="row">
        <form class="col s12">
            <div class="row">
                <div class="input-field col s6">
                    <i class="material-icons prefix">textsms</i>
                    <input placeholder="Placeholder" id="first_name" type="text" class="validate">
                    <label for="first_name">Task Name</label>
                </div>
                <div class="input-field col s6">
                    <input id="last_name" type="text" class="validate">
                    <label for="last_name">WCAs</label>
                </div>
            </div>

            <div class="row">
                <div class="input-field col s1">
                    Start:
                </div>
                <div class="input-field col s5">
                    <input type="text" class="datepicker">
                    <label for="datepicker">Start Date</label>
                </div>
                <div class="input-field col s5">
                    <input type="text" class="timepicker">
                    <label for="timepicker">Start Time</label>
                </div>
            </div>

            <div class="row">
                <div class="input-field col s1">
                    End:
                </div>
                <div class="input-field col s5">
                    <input type="text" class="datepicker">
                    <label for="datepicker">End Date</label>
                </div>
                <div class="input-field col s5">
                    <input type="text" class="timepicker">
                    <label for="timepicker">End Time</label>
                </div>
            </div>

            <div class="row">

                <div class="input-field col s1">
                    WCAs:
                </div>
                <div class="chips chips-autocomplete"></div>
            </div>

            <div class="row">
                <button class="btn waves-effect waves-light" type="submit" name="action">Submit
                    <i class="material-icons right">send</i>
                </button>
            </div>
        </form>
    </div>
</div>
</body>
<script>
    $('.chips-autocomplete').material_chip();

    $('.datepicker').pickadate({
        selectMonths: true,
        selectYears: 15,
        today: 'Today',
        clear: 'Clear',
        close: 'Ok',
        closeOnSelect: false
    });


    $('.timepicker').pickatime({
        default: 'now',
        fromnow: 0,
        twelvehour: false,
        donetext: 'OK',
        cleartext: 'Clear',
        canceltext: 'Cancel',
        autoclose: false,
        ampmclickable: true,
        aftershow: function () {
        }
    });


    //
    var testJson = [
        {
            "name": "Control 1",
            "wca": "WCA-001, WCA-003"
        },
        {
            "name": "Control 2",
            "wca": "WCA-004, WCA-005, WCA-006"
        }
    ];

    var dynatable = $('#my-final-table').dynatable({
        dataset: {
            records: testJson
        }
    }).data('dynatable');

    var testFunc = function (json) {
        // var json = JSON.parse($(this).text());
        // $records.removeClass('error');
        // $records.addClass('error');
        dynatable.settings.dataset.originalRecords = json;
        dynatable.process();
    };

    // add selector
    $('select').material_select();
    $('span.dynatable-per-page').addClass("col s6");


    var styleFunction = function (feature) {
        // console.log("test");
        // console.log(feature);
        return new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'red',
                width: 2
            }),
            fill: new ol.style.Fill({
                color: 'rgba(255,0,0,0.2)'
            }),
            text: new ol.style.Text({
                fill: new ol.style.Fill({color: feature.get("textColor")}),
                stroke: new ol.style.Stroke({color: "#ffffff", width: 2}),
                scale: 1,
                width: 3,
                textAlign: "center",
                textBaseline: "center",
                offsetY: 0,
                text: feature.get("text"),
                font: "Courier New, monospace"
            })
        });
    };

    var vectorSource = new ol.source.Vector({});
    vectorSource.addFeature(new ol.Feature(new ol.geom.Circle([5e6, 7e6], 1e6)));

    var vectorLayer = new ol.layer.Vector({
        source: vectorSource,
        style: styleFunction
    });

    var map = new ol.Map({
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            }),
            vectorLayer
        ],
        target: 'map',
        controls: ol.control.defaults({
            attributionOptions: {
                collapsible: false
            }
        }),
        view: new ol.View({
            center: [0, 0],
            zoom: 2
        })
    });

    // For Debug
    var test;

    // Make Features
    window.onload = function () {

//  var t = vectorSource.getFeatures();
//  var geoms = t[0].getGeometry();
//  t[0].set("text", "Name Test");
        var lat = 35.681167, lon = 139.767052;
        var newCoord = ol.proj.transform([lon, lat], 'EPSG:4326', 'EPSG:3857');
        var v = map.getView();
        v.setCenter(newCoord);
        v.setZoom(14);

        for (var i = 0; i < 1; i++) {
            // vectorSource.addFeature(new ol.Feature(new ol.geom.Circle(newCoord, 1000)));

            var te = new ol.geom.Circle(newCoord, 1000);
            var fe = new ol.Feature(te);
            vectorSource.addFeature(fe);
            test = fe;

            fe.set("text", "WCA-001");
            var gm = fe.getGeometry();
            gm.translate(1000, 1000);

            var gc = gm.getCenter();

            ol.coordinate.add(gc, [1000, 10]);

            var f = new ol.Feature(new ol.geom.Circle(gc, 1000));
            f.set("text", "WCA-002");
            vectorSource.addFeature(f);
        }
    };

    // select interaction working on "click"
    var selectClick = new ol.interaction.Select({
        condition: ol.events.condition.click
    });

    map.addInteraction(selectClick);
    selectClick.on('select', function (e) {
        console.log(
            e.target.getFeatures().getLength() +
            ' selected features (last operation selected ' + e.selected.length +
            ' and deselected ' + e.deselected.length + ' features)');

        var gfs = e.target.getFeatures();
        var g = gfs.getArray();

        // Remove All Chips
        $('.chips .chip').remove();
        for (var i = 0; i < gfs.getLength(); i++) {
            var selectedObject = g[i].get("text");
            console.log(selectedObject);

            // Make Chip
            $closeButton = $('<i>').addClass('close').addClass('material-icons').text('close');
            $chip = $('<div>').addClass('chip').text(selectedObject).append($closeButton);
            $('.chips').prepend($chip);
        }
    });

</script>
</html>